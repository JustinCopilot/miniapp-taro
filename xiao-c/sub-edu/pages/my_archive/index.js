"use strict";require("../../app"),(wx["subeduWebpackJsonp"]=wx["subeduWebpackJsonp"]||[]).push([[991],{701:function(e,n,t){var r=t(6619),o=t(1905),a=t(6603),c=t(1949),i=t(2903),l=t(6978),s=t(1479),u=t(7463),d=t.n(u),v=t(8190),f=t(7211),h=t(410),m=t(3512),p=t.n(m),x=t(7376),g=t(9717),C=t(9633),D=t(1701);function j(e,n){var t;D.Z&&((0,C.mf)(e)||console.error("useThrottleFn expected parameter is a function, got ".concat((0,f.Z)(e))));var r=(0,x.Z)(e),o=null!==(t=null===n||void 0===n?void 0:n.wait)&&void 0!==t?t:1e3,a=(0,s.useMemo)((function(){return p()((function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return r.current.apply(r,(0,h.ev)([],(0,h.CR)(e),!1))}),o,n)}),[]);return(0,g.Z)((function(){a.cancel()})),{run:a,cancel:a.cancel,flush:a.flush}}var b=j,N=t(8513),T=t.n(N),Z=t(2966),S=t(2336),w=t(9645),y=t(5404),E=function(e){var n=e.content;return(0,y.jsxs)(v.G7,{className:"no-data",children:[(0,y.jsx)(v.G7,{className:"img"}),(0,y.jsx)(v.G7,{className:"content",children:n||"\u6682\u65e0\u6570\u636e"})]})},_=E,I=t(4275),G=(t(1784),t(3380),t(2392),function(e){var n=e.onlyShowFilterChild,t=e.isLatest,r=e.date,o=e.onTriggerCalendar,a=e.selectedChildData,c=function(){t&&r&&(null===o||void 0===o||o(r))};return(0,y.jsxs)(v.G7,{className:"title-block",children:[(0,y.jsxs)(v.G7,{className:"left",onClick:c,children:[(0,y.jsx)(v.G7,{className:"date",children:T()(r).format("YYYY\u5e74MM\u6708DD\u65e5")}),t&&(0,y.jsx)(v.G7,{className:"arrow-right"})]}),(t||n)&&(0,y.jsx)(v.C3,{url:"".concat(S.gn,"/choose_child/index?selectedChildData=").concat(null===a||void 0===a?void 0:a.join()),className:"filter ".concat(null!==a&&void 0!==a&&a.length?"active":""),children:"\u7b5b\u9009\u5e7c\u513f"})]})}),k=G,O=function(e){var n=e.showTimeLine,t=e.contentItem,r=e.currentNav,o=e.selectedChildData,c=function(e,n){e.stopPropagation(),d().previewImage({current:n,urls:h.map((function(e){return e.url}))})},i=function(e){e.stopPropagation(),d().previewMedia({sources:f.map((function(e){return{url:e.videoUrl,type:"video",poster:e.videoCoverUrl}}))})},l=function(){d().setStorageSync(w.Ig.EDU_SELECTED_CHILD_DATA,o),d().navigateTo({url:"".concat(S.gn,"/").concat(2===r?"jot_down_detail":"observation_detail","/index?observeId=").concat(t.observeId)})},u=function(e){return"null"!==e&&e?e.split(","):[]},f=(0,s.useMemo)((function(){var e=u(t.videoCoverUrl),n=u(t.videoUrl);return n.filter(Boolean).map((function(n,t){return{videoUrl:n,videoCoverUrl:e[t]}})).slice(0,4)}),[t]),h=(0,s.useMemo)((function(){return[].concat((0,a.Z)(u(t.aiImgUrl).map((function(e){return{url:e,type:"ai"}}))),(0,a.Z)(u(t.imgUrl).map((function(e){return{url:e,type:""}})))).filter(Boolean).slice(0,4-f.length)}),[t,f]);return(0,y.jsxs)(v.G7,{className:"content-block",children:[(0,y.jsxs)(v.G7,{className:"time-line",children:[(0,y.jsx)(v.G7,{className:"round"}),(0,y.jsx)(v.G7,{className:"line",style:{visibility:n?"visible":"hidden"}})]}),(0,y.jsxs)(v.G7,{className:"right",children:[(0,y.jsx)(v.G7,{className:"time",children:T()(t.observeTime).format("HH:mm")}),(0,y.jsxs)(v.G7,{className:"content-wrapper",style:{marginBottom:n?20:0},onClick:l,children:[(0,y.jsx)(v.G7,{className:"content",children:t.content}),(0,y.jsxs)(v.G7,{className:"photos",children:[f.map((function(e){return(0,y.jsx)(v.nk,{src:e.videoUrl,poster:e.videoCoverUrl,className:"photo",onClick:i},e.videoCoverUrl)})),h.map((function(e){return(0,y.jsxs)(v.G7,{className:"image-item",children:[(0,y.jsx)(v.Ee,{mode:"aspectFill",className:"photo",src:e.url,onClick:function(n){return c(n,e.url)}},e.url),"ai"===e.type&&(0,y.jsx)(v.Ee,{src:"https://senior.cos.clife.cn/xiao-c/25DB1C54-F306-4104-BD5C-F607E0CDED08.png",className:"ai-tag"})]},e.url)}))]})]})]})]})},R=O,L=function(e){return e[e["OBSERVATION_RECORD"]=1]="OBSERVATION_RECORD",e[e["WITH_NOTES"]=2]="WITH_NOTES",e}(L||{}),U=[{label:"\u968f\u624b\u8bb0",value:L.WITH_NOTES},{label:"\u89c2\u5bdf\u8bb0\u5f55",value:L.OBSERVATION_RECORD}],A=function(){var e=(0,s.useState)(!1),n=(0,l.Z)(e,2),t=n[0],r=n[1],u=(0,s.useState)([]),f=(0,l.Z)(u,2),h=f[0],m=f[1],p=(0,s.useState)(),x=(0,l.Z)(p,2),g=x[0],C=x[1],D=(0,s.useState)(L.WITH_NOTES),j=(0,l.Z)(D,2),N=j[0],E=j[1],G=(0,s.useState)(!1),O=(0,l.Z)(G,2),A=O[0],B=O[1],Y=(0,s.useState)([]),H=(0,l.Z)(Y,2),M=H[0],F=H[1],W=(0,s.useState)([]),K=(0,l.Z)(W,2),P=K[0],V=K[1],J=(0,s.useState)([]),Q=(0,l.Z)(J,2),q=Q[0],z=Q[1],X=(0,s.useState)([!0]),$=(0,l.Z)(X,2),ee=$[0],ne=$[1],te=(0,s.useState)(0),re=(0,l.Z)(te,2),oe=re[0],ae=re[1],ce=(0,s.useRef)(),ie=(0,s.useRef)(),le=(0,s.useRef)([]),se=function(){var e=(0,i.Z)((0,o.Z)().mark((function e(n,t){var r,i;return(0,o.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,I.Zs)((0,c.Z)({source:N,studentId:q.join()},n));case 2:i=e.sent,(null===i||void 0===i?void 0:i.length)>0?F(t?[].concat((0,a.Z)(M),(0,a.Z)(i)):i):(B(!0),d().showToast({title:"\u6682\u65e0\u66f4\u591a\u6570\u636e",icon:"none"}),t||F([])),null===(r=ie.current)||void 0===r||r.exec((function(e){le.current=e[0].map((function(e){return e.top}))}));case 5:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),ue=function(){var e=(0,i.Z)((0,o.Z)().mark((function e(n){var t;return(0,o.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,I.rw)((0,c.Z)({source:N},n));case 2:if(t=e.sent,!((null===t||void 0===t?void 0:t.length)>0)){e.next=5;break}return e.abrupt("return",t.filter((function(e){return!M.find((function(n){return n.observeDate===e}))})).reverse());case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),de=function(){var e=(0,i.Z)((0,o.Z)().mark((function e(n){var t,a;return(0,o.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:C(n.value),setTimeout((function(){r(!1)}),200),t=M.filter((function(e){return e.observeDate===n.value})),t.length>0?null===(a=ie.current)||void 0===a||a.exec((function(){P.forEach((function(e,t){var r;n.value===e.observeDate&&ae((null===(r=le.current)||void 0===r?void 0:r[t])-S.K1-40)}))})):(se({dateTime:n.value},!1),he());case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ve=function(){var e=(0,i.Z)((0,o.Z)().mark((function e(n){var t;return(0,o.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!==q.length){e.next=5;break}return e.next=3,ue({month:n.slice(0,7)});case 3:t=e.sent,t.length>0&&m([].concat((0,a.Z)(h),(0,a.Z)(t.map((function(e){return{value:e}})))));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),fe=function(e){E(e)},he=function(){var e;null===(e=ce.current)||void 0===e||e.exec((function(e){var n,t=null===(n=e[0])||void 0===n?void 0:n.node;null===t||void 0===t||t.scrollTo({top:0})}))},me=function(e){t||C(e),r(!t)},pe=b((function(){var e;null===(e=ie.current)||void 0===e||e.exec((function(e){var n;ne([!0].concat(null===(n=e[0])||void 0===n?void 0:n.map((function(e){return e.top-S.K1<65})).slice(1)))}))})),xe=pe.run,ge=b((function(){A||P.length!==M.length||se({dateTime:T()(M[M.length-1].observeDate).subtract(1,"day").format("YYYY-MM-DD")},!0)})),Ce=ge.run;return d().useReady((function(){d().eventCenter.on("selectedChildData",(function(e){m([]),z(e)})),d().eventCenter.on("detailEditSave",(function(e){setTimeout((function(){var n=d().getStorageSync(w.Ig.EDU_SELECTED_CHILD_DATA);se({source:e,studentId:n||""}),n&&d().removeStorageSync(w.Ig.EDU_SELECTED_CHILD_DATA)}),1e3)})),ce.current=d().createSelectorQuery().in(d().getCurrentInstance().page).select("#my_archive_list_scroll_view").node(),ie.current=d().createSelectorQuery().in(d().getCurrentInstance().page).selectAll(".title-block").boundingClientRect()})),(0,s.useEffect)((function(){se(),B(!1),he()}),[N,q]),(0,s.useEffect)((function(){var e;V(M),C(null===(e=M[0])||void 0===e?void 0:e.observeDate),m([].concat((0,a.Z)(h),(0,a.Z)(M.map((function(e){return{value:e.observeDate}})))))}),[M]),(0,s.useEffect)((function(){m([])}),[N]),(0,y.jsxs)(v.G7,{className:"my-archive",style:{paddingTop:S.K1},children:[(0,y.jsx)(Z.zg,{border:!1,leftIconType:"chevron-left",color:"#1E222F",onClickLeftIcon:function(){return d().navigateBack()},children:(0,y.jsx)(v.G7,{className:"nav-bar-header",children:U.map((function(e){return(0,y.jsx)(v.G7,{className:"item ".concat(e.value===N?"active":""),onClick:function(){return fe(e.value)},children:e.label},e.value)}))})}),(0,y.jsx)(v.G7,{className:"calendar",style:{display:t?"block":"none",top:S.K1},children:(0,y.jsx)(Z.Y4,{onDayClick:de,onMonthChange:ve,currentDate:g,maxDate:Date.now(),marks:h,validDates:h})}),(0,y.jsxs)(v.pf,{className:"list",id:"my_archive_list_scroll_view",scrollY:!0,scrollWithAnimation:!0,lowerThreshold:500,enhanced:!0,scrollTop:oe,showScrollbar:!0,onScroll:xe,onScrollToLower:Ce,children:[null===P||void 0===P?void 0:P.map((function(e,n){var t;return(0,y.jsxs)(v.G7,{className:"item-by-date",children:[(0,y.jsx)(k,{ref:ie,date:e.observeDate,isLatest:ee[n],onTriggerCalendar:function(e){return me(e)},selectedChildData:q}),(0,y.jsx)(v.G7,{className:"container",onClick:function(){return r(!1)},children:null===(t=e.observeList)||void 0===t?void 0:t.map((function(n,t){var r;return(0,y.jsx)(R,{currentNav:N,showTimeLine:t!==(null===(r=e.observeList)||void 0===r?void 0:r.length)-1,contentItem:n,selectedChildData:q.join()},n.observeId)}))})]},e.observeDate)})),0===(null===M||void 0===M?void 0:M.length)&&(0,y.jsxs)(v.G7,{children:[(0,y.jsx)(k,{onlyShowFilterChild:!0,selectedChildData:q}),(0,y.jsx)(_,{})]})]})]})},B=A,Y={navigationBarTitleText:"\u6211\u7684\u5f52\u6863",navigationStyle:"custom"};Page((0,r.createPageConfig)(B,"pages/my_archive/index",{root:{cn:[]}},Y||{}))}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[107,216,592],(function(){return n(701)}));e.O()}]);