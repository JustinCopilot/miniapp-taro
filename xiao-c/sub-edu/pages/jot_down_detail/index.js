"use strict";require("../../app"),(wx["subeduWebpackJsonp"]=wx["subeduWebpackJsonp"]||[]).push([[581],{9152:function(e,n,t){var a=t(6619),s=t(1949),o=t(6978),r=t(1479),i=t(8190),c=t(2967),l=t(7463),u=t.n(l),d=t(4275),m=t(4537),f=t(8513),v=t.n(f),N=t(9800),p=t(9645),x=t(2336),h=t(33),A=t(2027),j=t(6933),R=t(6838),g=t(1204),b=t(289),E=t(9978),G=(t(3380),t(5404)),_=function(e){return e[e["UN_ANALYZE"]=0]="UN_ANALYZE",e[e["STAR_ANALYZE"]=1]="STAR_ANALYZE",e[e["ERROR_ANALYZE"]=2]="ERROR_ANALYZE",e}({}),Z=function(){var e=(0,l.useRouter)(),n=(0,r.useState)(!1),t=(0,o.Z)(n,2),a=t[0],f=t[1],Z=(0,r.useState)(),T=(0,o.Z)(Z,2),L=T[0],U=T[1],I=(0,r.useState)(_.UN_ANALYZE),O=(0,o.Z)(I,2),Y=O[0],D=O[1],k=(0,r.useState)(),S=(0,o.Z)(k,2),C=S[0],y=S[1],w=(0,m.Z)(d.Ds,{manual:!0}),J=w.data,P=w.run,B=(0,r.useRef)(),W=(0,r.useRef)(),z=(0,E.Z)(),F=z.transformStreamToArray,q=function(){return f(!1)},H=function(){u().navigateTo({url:"".concat(x.gn,"/jot_down_reference_detail/index?observeId=").concat(e.params.observeId)})},M=function(){var e=(0,N.R0)(-1);e.setData({isRefresh:!0});var n=(0,N.R0)();n.setData({observationdetail:C}),u().navigateTo({url:"".concat(x.gn,"/information_supplement/index")})},Q=function(e){console.log("\u91cd\u65b0\u8bf7\u6c42"),$({userParam:e})},V=function(){(0,d.$P)({observeId:Number(e.params.observeId)}).then((function(){u().showToast({title:"\u5220\u9664\u6210\u529f",icon:"none"}),setTimeout((function(){u().navigateBack()}),1e3)})).finally((function(){q()}))},$=function(e){console.log("\u89e6\u53d1\u6d41\u5f0f\u5bf9\u8bdd",e),D(_.STAR_ANALYZE),W.current=u().request({method:"POST",url:"".concat((0,h.S)(),"/v1/microApp/chat"),enableChunked:!0,responseType:"text",data:(0,s.Z)({microAppUuid:R.Gv.EDU_JOT_DOWN},e),header:{Authorization:(0,A.LP)()},complete:function(){D(_.UN_ANALYZE)},fail:function(){D(_.ERROR_ANALYZE)}}),W.current.onChunkReceived((function(e){var n,t=F(e);t&&(console.log("streamDataArr==",t),0===t[0].errCode?(t.forEach((function(e){var t,a=e.data;n=null===(t=JSON.parse((null===a||void 0===a?void 0:a.agentResponse)||"{}"))||void 0===t?void 0:t.data})),U(n)):D(_.ERROR_ANALYZE))}))},K=function(){var e;null===(e=W.current)||void 0===e||e.abort(),(0,j.Qv)({microAppUuid:R.Gv.EDU_JOT_DOWN})};return(0,l.useDidShow)((function(){var e=(0,N.R0)();if(e.data.from===p.w6.EDIT_OBSERVATION){var n=e.data.observationdetail;console.log("=observationdetail",n),y(n),Q(n)}})),(0,r.useEffect)((function(){if(J){var e,n,t={tag:g.UR.BehaviorRecord,flag:!!J.flag,resultType:"\u76ee\u6807\u95ee\u9898",observeId:J.observeId,student:J.studentList.map((function(e){var n=e.birthday,t=e.studentId,a=e.sex,s=e.studentName,o=e.avatar;return{birthday:n,studentId:t,sex:a,avatar:o,studentName:s}})),extractInfo:{date:J.observeDate,input:J.content,situationList:null===(e=J.situationList)||void 0===e?void 0:e.map((function(e){return e.situationName})),photo:{imgUrl:J.imgUrl,aiImgUrl:J.aiImgUrl,videoCoverUrl:J.videoCoverUrl,videoUrl:J.videoUrl},sectorList:null===(n=J.sectorTypeList)||void 0===n?void 0:n.map((function(e){return{area:e.typeName,sub:e.sectorList.map((function(e){return e.sectorName}))}}))}},a=(0,N.R0)();a.setData({observationdetail:t}),y(t)}}),[J]),(0,r.useEffect)((function(){console.log("agentResponse",L),B.current=L}),[L]),(0,r.useEffect)((function(){e.params.observeId&&P({observeId:Number(e.params.observeId)})}),[e]),(0,r.useEffect)((function(){(0,j.u3)((0,s.Z)({microAppUuid:R.Gv.EDU_JOT_DOWN},{pageNumb:9999,pageSize:10}))}),[]),(0,G.jsxs)(i.G7,{className:"jot-down-detail",children:[(0,G.jsx)(i.G7,{className:"student-info",children:C&&(0,G.jsx)(c.Z,{students:C.student,extractInfo:C.extractInfo})}),Y===_.STAR_ANALYZE&&(0,G.jsxs)(i.G7,{className:"loading-error",children:[(0,G.jsx)(i.G7,{className:"text",children:"\u5206\u6790\u5efa\u8bae\u52a0\u8f7d\u4e2d\u2026"}),(0,G.jsx)(i.G7,{className:"btn cancel",onClick:K,children:"\u53d6\u6d88"})]}),Y===_.ERROR_ANALYZE&&(0,G.jsxs)(i.G7,{className:"loading-error",children:[(0,G.jsx)(i.G7,{className:"text",children:"\u5206\u6790\u5efa\u8bae\u52a0\u8f7d\u5931\u8d25"}),(0,G.jsx)(i.G7,{className:"sub-text",children:"\u8bf7\u68c0\u67e5\u7f51\u7edc\u8bbe\u7f6e"}),(0,G.jsx)(i.G7,{className:"btn retry",onClick:function(){return Q(C)},children:"\u91cd\u8bd5"})]}),(J||L)&&Y===_.UN_ANALYZE&&(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(i.G7,{className:"analyze-info",children:L?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(i.xv,{decode:!0,children:L.content}),(0,G.jsxs)(i.G7,{className:"update-time",children:["\u6700\u65b0\u4fee\u6539\u65e5\u671f ",v()().format("YYYY-MM-DD")]})]}):(0,G.jsxs)(G.Fragment,{children:[null===J||void 0===J?void 0:J.studentList.map((function(e){return e.evaluate?(0,G.jsxs)(i.G7,{className:"analyze-item",children:[(0,G.jsxs)(i.G7,{className:"header",children:["\u5bf9",e.studentName,"\u7684\u884c\u4e3a\u5206\u6790\u5efa\u8bae"]}),(0,G.jsx)(i.G7,{className:"content",children:e.evaluate})]},e.studentId):null})),(null===J||void 0===J?void 0:J.updateTime)&&(0,G.jsxs)(i.G7,{className:"update-time",children:["\u6700\u65b0\u4fee\u6539\u65e5\u671f ",J.updateTime.slice(0,10)]})]})}),(0,G.jsxs)(i.G7,{className:"operation",children:[!e.params.hideBtn&&(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(i.G7,{className:"update",onClick:M,children:(0,G.jsx)(i.G7,{className:"icon update-icon"})}),(0,G.jsx)(i.G7,{className:"delete",onClick:function(){return f(!0)},children:(0,G.jsx)(i.G7,{className:"icon delete-icon"})})]}),(0,G.jsxs)(i.G7,{className:"refresh",onClick:function(){return Q(C)},children:[(0,G.jsx)(i.G7,{className:"icon refresh-icon"}),"\u91cd\u65b0\u751f\u6210"]}),(0,G.jsxs)(i.G7,{className:"link",onClick:H,children:[(0,G.jsx)(i.G7,{className:"icon link-icon"}),"\u67e5\u770b\u6570\u636e\u5f15\u7528\u8be6\u60c5"]})]})]}),(0,G.jsx)(b.Z,{isOpened:a,closeHandle:q,okHandle:V,content:"\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u968f\u624b\u8bb0\u5417\uff1f",okText:"\u5220\u9664"})]})},T=Z,L={navigationBarTitleText:"\u968f\u624b\u8bb0\u8be6\u60c5"};Page((0,a.createPageConfig)(T,"pages/jot_down_detail/index",{root:{cn:[]}},L||{}))}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[107,216,592],(function(){return n(9152)}));e.O()}]);